<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" lang="eng">
<head>
    <meta charset="UTF-8">
    <title>Students</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        window.onload = function() {
            const alert = document.querySelector('.alert');
            if (alert) {
                setTimeout(() => {
                    alert.style.display = 'none';
                }, 5000);
            }
        };
    </script>

</head>
<body>
<!--<div th:if="${param.success}" class="d-flex justify-content-center">-->
<!--    <div class="alert alert-info alert-dismissible fade show" role="alert" style="max-width: 400px;">-->
<!--        Login successful !!!-->
<!--        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>-->
<!--    </div>-->
<!--</div>-->

<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
    <div class="container-fluid d-flex justify-content-between">
        <ul class="navbar-nav mx-auto">
            <li class="nav-item">
                <a class="nav-link" th:href="@{/students}">Students</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/users}">Users</a>
            </li>
        </ul>

        <div class="d-flex align-items-center">
      <span class="navbar-text text-light me-3">
          Welcome, <a th:href="@{/profile(username=${#authentication.principal.username})}" sec:authentication="principal.username"></a> (Role: <span sec:authentication="principal.authorities"/>)
      </span>
            <a class="link-primary" th:href="@{/logout}">Logout</a>
        </div>
    </div>
</nav>

<div th:if="${param.success}" class="alert alert-success alert-dismissible fade show position-absolute" role="alert" style="top: 0; left: 50%; transform: translateX(-50%); z-index: 1;">
    <span>Login successful !!!</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<h2 class="text-center">Students List</h2>
<div class="d-flex justify-content-between align-items-center mb-4">
    <a th:if="${#authorization.expression('hasAuthority(''ROLE_ADMIN'')')}" class="btn btn-success" href="/students/create">Add new student</a>

    <form th:action="@{/students/search}" method="get">
        <div class="input-group">
            <input type="text" name="keywords" class="form-control" placeholder="Search for students...">
            <button class="btn btn-primary" type="submit">Search</button>
        </div>
    </form>
</div>
<table class="table table-dark table-striped">
    <thead>
    <tr>
        <th>Id</th>
        <th>FullName</th>
        <th>Email</th>
        <th>Age</th>
        <th>Address</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>John</td>
        <td>Doe</td>
        <td>john@example.com</td>
        <td>john@example.com</td>
        <td>john@example.com</td>
        <td>
            <a class="btn btn-warning btn-sm">Edit</a>
            <a class="btn btn-danger btn-sm">Delete</a>
        </td>
    </tr>
    <tr th:each="student : ${students}">
        <td th:text="${student.id}"></td>
        <td th:text="${student.fullName}"></td>
        <td th:text="${student.email}"></td>
        <td th:text="${student.age}"></td>
        <td th:text="${student.address}"></td>
        <td>
            <a th:if="${#authorization.expression('hasAuthority(''ROLE_ADMIN'')')}" th:href="@{/students/edit/{id}(id=${student.id})}" class="btn btn-warning btn-sm">Edit</a>
            <a th:if="${#authorization.expression('hasAuthority(''ROLE_ADMIN'')')}"
               th:href="@{/students/delete/{id}(id=${student.id})}"
               onclick="return confirm('Are you sure you want to delete?');"
               class="btn btn-danger btn-sm">Delete</a>

        </td>
    </tr>
    </tbody>
</table>
</body>
</html>
